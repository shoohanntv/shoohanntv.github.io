<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Embedded Shaka Player — Fullscreen, Center Poster/Logo, Custom Controls</title>
  <script src="https://unpkg.com/shaka-player@4.16.8/dist/shaka-player.compiled.js"></script>
  <style>
    /* Full-bleed container for embedding */
    :root{--accent:#ff2d7a}
    html,body{height:100%;margin:0}
    .embed-wrapper{position:relative;width:100%;height:100vh;background:#000;overflow:hidden;display:flex;align-items:center;justify-content:center}

    video#video{width:100%;height:100%;object-fit:cover;background:#000}

    /* Centered large logo/poster (like your screenshot) */
    .center-poster{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .center-poster img{max-width:85%;max-height:85%;height:auto;opacity:1;filter:none}

    /* Bottom control bar (overlay) */
    .controls{position:absolute;left:0;right:0;bottom:0;display:flex;align-items:center;gap:10px;padding:10px 14px;background:linear-gradient(180deg,rgba(0,0,0,0) 0%, rgba(0,0,0,0.5) 40%, rgba(0,0,0,0.75) 100%)}
    .btn{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);padding:8px;border-radius:8px;color:#fff;cursor:pointer}
    .btn:hover{background:rgba(255,255,255,0.12)}
    .progress{flex:1;display:flex;align-items:center;gap:8px}
    .progress input[type=range]{width:100%}
    .time{min-width:78px;color:#ddd;font-size:13px;text-align:right}

    /* Small top bar for embed label */
    .topbar{position:absolute;left:12px;top:12px;background:rgba(0,0,0,0.6);padding:8px 12px;border-radius:8px;color:#eee;font-size:13px}

    /* Make sure fullscreen covers parent when embedded in iframe */
    .fullscreen-active{position:fixed;left:0;top:0;width:100%;height:100%;z-index:99999}

    /* Responsive tweaks */
    @media (max-width:600px){ .center-poster img{max-width:95%;max-height:70%} .time{display:none} }
  </style>
</head>
<body>
  <div id="playerContainer" class="embed-wrapper">
    <!-- Video element (Shaka will attach streams here) -->
    <video id="video" playsinline webkit-playsinline controls></video>

    <!-- Centered poster/logo image (data URI embedded) -->
    <div class="center-poster" id="centerPoster">
      <img alt="Channel Logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB2wAAAQ3CAYAAAA0W55pAAAAAXNSR0IArs4c6QA...p5nrVVV+9679+57q63WvX2V7UixY3AcJiY+RPjY2HHAmOQozDl4CAdjMrZDsAKM">
    </div>

    <div class="topbar">topstream.space — embedded player</div>

    <div class="controls" id="controls">
      <button class="btn" id="playPause">Play</button>
      <button class="btn" id="muteBtn">Mute</button>
      <div class="progress">
        <input id="seek" type="range" min="0" max="100" value="0">
      </div>
      <div class="time" id="time">0:00 / 0:00</div>
      <button class="btn" id="pipBtn">PIP</button>
      <button class="btn" id="fsBtn">Full</button>
    </div>
  </div>

  <script>
    (function(){
      const video = document.getElementById('video');
      const playPause = document.getElementById('playPause');
      const muteBtn = document.getElementById('muteBtn');
      const seek = document.getElementById('seek');
      const timeEl = document.getElementById('time');
      const pipBtn = document.getElementById('pipBtn');
      const fsBtn = document.getElementById('fsBtn');
      const centerPoster = document.getElementById('centerPoster');
      const playerContainer = document.getElementById('playerContainer');

      // Shaka setup
      if (!window.shaka) { console.error('Shaka not loaded'); }
      shaka.polyfill.installAll();
      const player = new shaka.Player(video);
      player.addEventListener('error', e => console.error('Shaka error', e));

      // Example manifest — you can replace when embedding
      const DEFAULT_MANIFEST = 'https://abkf7g7aaaaaaaamcmmhhhyli5fwh.otte.live.cf.ww.aiv-cdn.net/pdx-nitro/live/clients/dash/enc/u142pfptsm/out/v1/1caa3b2dfa9e448d8f61209bdfc1acdc/cenc.mpd';

      player.getNetworkingEngine().registerRequestFilter((type, request) => {
        if (type == shaka.net.NetworkingEngine.RequestType.LICENSE) {
          // Example: if embedding you may want to add custom headers from attributes or query params.
          // request.headers['key1'] = 'KEY1VALUE';
          // request.headers['key2'] = 'KEY2VALUE';
        }
      });

      async function load(manifest=DEFAULT_MANIFEST){
        try{
          await player.load(manifest);
          console.log('Loaded', manifest);
          // Hide center poster once content is ready to play
          centerPoster.style.display = 'none';
        }catch(err){console.error('Load failed',err)}
      }

      // Basic control bindings
      playPause.addEventListener('click', ()=>{
        if (video.paused) video.play(); else video.pause();
      });
      video.addEventListener('play', ()=> playPause.textContent='Pause');
      video.addEventListener('pause', ()=> playPause.textContent='Play');

      muteBtn.addEventListener('click', ()=>{
        video.muted = !video.muted; muteBtn.textContent = video.muted ? 'Unmute' : 'Mute';
      });

      // Seek bar
      video.addEventListener('timeupdate', ()=>{
        if (!isNaN(video.duration) && video.duration>0) {
          const pct = (video.currentTime/video.duration)*100;
          seek.value = pct;
          timeEl.textContent = formatTime(video.currentTime) + ' / ' + formatTime(video.duration);
        }
      });
      seek.addEventListener('input', ()=>{
        if (!isNaN(video.duration) && video.duration>0) {
          const t = (seek.value/100)*video.duration; video.currentTime = t;
        }
      });

      // Picture-in-Picture
      pipBtn.addEventListener('click', async ()=>{
        try{
          if (document.pictureInPictureElement) await document.exitPictureInPicture();
          else await video.requestPictureInPicture();
        }catch(e){console.warn('PIP failed',e)}
      });

      // Fullscreen toggle that works well when embedded in an iframe
      fsBtn.addEventListener('click', async ()=>{
        const el = playerContainer;
        // If already fullscreen, exit
        if (document.fullscreenElement) {
          await document.exitFullscreen();
          el.classList.remove('fullscreen-active');
          fsBtn.textContent = 'Full';
        } else {
          // Try to request fullscreen on the container
          try{ await el.requestFullscreen({navigationUI: 'hide'}); el.classList.add('fullscreen-active'); fsBtn.textContent='Exit'; }
          catch(e){ console.warn('Fullscreen request failed', e); }
        }
      });

      // Utility
      function formatTime(s){
        if (isNaN(s) || s===Infinity) return '0:00';
        const m=Math.floor(s/60); const sec=Math.floor(s%60).toString().padStart(2,'0'); return m+':'+sec;
      }

      // Auto-load manifest on init (comment out if you want to control externally)
      load();

      // Expose a small API for embedding pages to control the player via postMessage
      window.addEventListener('message', (ev)=>{
        // Accept messages from parent that are objects like {type:'load',manifest:'...'}
        const data = ev.data || {};
        if (data && data.type==='load' && data.manifest) load(data.manifest);
        if (data && data.type==='play') video.play();
        if (data && data.type==='pause') video.pause();
        if (data && data.type==='setPoster'){
          // set center poster image; expects data.url
          if (data.url){ document.querySelector('.center-poster img').src=data.url; document.querySelector('.center-poster').style.display='flex'; }
        }
      });

      // When video ends, show poster again
      video.addEventListener('ended', ()=>{ document.querySelector('.center-poster').style.display='flex'; });

    })();
  </script>
</body>
</html>
